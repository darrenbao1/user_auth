## Overview

This project is a containerized authentication system built to showcase a
realistic user authentication flow.

It consists of three services: a PostgreSQL database, an authentication backend
implemented with Node.js and Express, and a separate email service used for
sending verification emails via Gmail SMTP.

The system supports signup, login, email verification, and refresh token
handling. The scope is intentionally limited to core authentication features
for interview demonstration purposes.

## Authentication Flow

1. User logs in with credentials
2. user-auth validates credentials via user-auth-db
3. Access token (JWT) is issued (short-lived)
4. Refresh token is issued and stored hashed in the database
5. Refresh token rotation is enforced

## Security Considerations

- Access tokens are short-lived JWTs
- Refresh tokens are stored hashed (Hashed using SHA256, not using bcrypt due to token lookup)
- Token rotation is implemented to prevent replay attacks
- HTTP-only cookies are used to mitigate XSS
- Passwords are hashed using bcrypt/argon2


## System Diagram

![SystemDiagram_09012026 drawio](https://github.com/user-attachments/assets/c40e51b2-e8dc-435a-8a30-2bc3fee9ef19)
<?xml version="1.0" encoding="UTF-8"?>
<!-- Do not edit this file with editors other than draw.io -->
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg xmlns="http://www.w3.org/2000/svg" style="background: transparent; background-color: transparent; color-scheme: light dark;" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="621px" height="591px" viewBox="0 0 621 591" content="&lt;mxfile host=&quot;app.diagrams.net&quot; agent=&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/143.0.0.0 Safari/537.36&quot; version=&quot;29.3.0&quot;&gt;&#10;  &lt;diagram name=&quot;Page-1&quot; id=&quot;5KnN_fOVHsGM_00pB5DO&quot;&gt;&#10;    &lt;mxGraphModel dx=&quot;1426&quot; dy=&quot;743&quot; grid=&quot;1&quot; gridSize=&quot;10&quot; guides=&quot;1&quot; tooltips=&quot;1&quot; connect=&quot;1&quot; arrows=&quot;1&quot; fold=&quot;1&quot; page=&quot;1&quot; pageScale=&quot;1&quot; pageWidth=&quot;1169&quot; pageHeight=&quot;826&quot; math=&quot;0&quot; shadow=&quot;0&quot;&gt;&#10;      &lt;root&gt;&#10;        &lt;mxCell id=&quot;0&quot; /&gt;&#10;        &lt;mxCell id=&quot;1&quot; parent=&quot;0&quot; /&gt;&#10;        &lt;mxCell id=&quot;pMmGdDlfeZ6K2ce_X3z6-1&quot; parent=&quot;1&quot; style=&quot;rounded=0;whiteSpace=wrap;html=1;&quot; value=&quot;Client (Browser)&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;100&quot; width=&quot;190&quot; x=&quot;480&quot; y=&quot;60&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;pMmGdDlfeZ6K2ce_X3z6-2&quot; edge=&quot;1&quot; parent=&quot;1&quot; source=&quot;pMmGdDlfeZ6K2ce_X3z6-1&quot; style=&quot;endArrow=classic;html=1;rounded=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;&quot; target=&quot;pMmGdDlfeZ6K2ce_X3z6-3&quot; value=&quot;&quot;&gt;&#10;          &lt;mxGeometry height=&quot;50&quot; relative=&quot;1&quot; width=&quot;50&quot; as=&quot;geometry&quot;&gt;&#10;            &lt;mxPoint x=&quot;560&quot; y=&quot;410&quot; as=&quot;sourcePoint&quot; /&gt;&#10;            &lt;mxPoint x=&quot;575&quot; y=&quot;300&quot; as=&quot;targetPoint&quot; /&gt;&#10;          &lt;/mxGeometry&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;pMmGdDlfeZ6K2ce_X3z6-3&quot; parent=&quot;1&quot; style=&quot;whiteSpace=wrap;html=1;aspect=fixed;&quot; value=&quot;User authentication service &amp;lt;br&amp;gt;(Node.js / Express)&amp;lt;div&amp;gt;&amp;lt;br/&amp;gt;&amp;lt;/div&amp;gt;&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;190&quot; width=&quot;190&quot; x=&quot;480&quot; y=&quot;262&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;pMmGdDlfeZ6K2ce_X3z6-4&quot; parent=&quot;1&quot; style=&quot;text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;&quot; value=&quot;HTTP (REST)&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;30&quot; width=&quot;60&quot; x=&quot;585&quot; y=&quot;190&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;pMmGdDlfeZ6K2ce_X3z6-5&quot; parent=&quot;1&quot; style=&quot;text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=left;verticalAlign=top;rounded=0;&quot; value=&quot;-Signup&amp;lt;br&amp;gt;-Login&amp;lt;br&amp;gt;-Refresh Token&amp;lt;div&amp;gt;-Verify Email&amp;lt;/div&amp;gt;&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;77&quot; width=&quot;190&quot; x=&quot;485&quot; y=&quot;375&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;pMmGdDlfeZ6K2ce_X3z6-6&quot; parent=&quot;1&quot; style=&quot;shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;&quot; value=&quot;Postgres&amp;lt;br&amp;gt;user-auth&amp;lt;br&amp;gt;DB&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;110&quot; width=&quot;110&quot; x=&quot;370&quot; y=&quot;540&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;pMmGdDlfeZ6K2ce_X3z6-7&quot; edge=&quot;1&quot; parent=&quot;1&quot; source=&quot;pMmGdDlfeZ6K2ce_X3z6-5&quot; style=&quot;endArrow=classic;html=1;rounded=0;exitX=0;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;entryPerimeter=0;&quot; target=&quot;pMmGdDlfeZ6K2ce_X3z6-6&quot; value=&quot;&quot;&gt;&#10;          &lt;mxGeometry height=&quot;50&quot; relative=&quot;1&quot; width=&quot;50&quot; as=&quot;geometry&quot;&gt;&#10;            &lt;mxPoint x=&quot;560&quot; y=&quot;410&quot; as=&quot;sourcePoint&quot; /&gt;&#10;            &lt;mxPoint x=&quot;610&quot; y=&quot;360&quot; as=&quot;targetPoint&quot; /&gt;&#10;          &lt;/mxGeometry&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;pMmGdDlfeZ6K2ce_X3z6-8&quot; parent=&quot;1&quot; style=&quot;text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;&quot; value=&quot;SQL&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;30&quot; width=&quot;60&quot; x=&quot;390&quot; y=&quot;470&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;pMmGdDlfeZ6K2ce_X3z6-9&quot; parent=&quot;1&quot; style=&quot;whiteSpace=wrap;html=1;aspect=fixed;&quot; value=&quot;Email Service&amp;lt;br&amp;gt;(Node.js / SMTP)&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;100&quot; width=&quot;100&quot; x=&quot;675&quot; y=&quot;540&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;pMmGdDlfeZ6K2ce_X3z6-10&quot; edge=&quot;1&quot; parent=&quot;1&quot; source=&quot;pMmGdDlfeZ6K2ce_X3z6-5&quot; style=&quot;endArrow=classic;html=1;rounded=0;entryX=0;entryY=0;entryDx=0;entryDy=0;exitX=0.926;exitY=1;exitDx=0;exitDy=0;exitPerimeter=0;&quot; target=&quot;pMmGdDlfeZ6K2ce_X3z6-9&quot; value=&quot;&quot;&gt;&#10;          &lt;mxGeometry height=&quot;50&quot; relative=&quot;1&quot; width=&quot;50&quot; as=&quot;geometry&quot;&gt;&#10;            &lt;mxPoint x=&quot;560&quot; y=&quot;410&quot; as=&quot;sourcePoint&quot; /&gt;&#10;            &lt;mxPoint x=&quot;610&quot; y=&quot;360&quot; as=&quot;targetPoint&quot; /&gt;&#10;          &lt;/mxGeometry&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;pMmGdDlfeZ6K2ce_X3z6-11&quot; parent=&quot;1&quot; style=&quot;rounded=0;whiteSpace=wrap;html=1;&quot; value=&quot;Email Server (Gmail)&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;100&quot; width=&quot;120&quot; x=&quot;870&quot; y=&quot;540&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;pMmGdDlfeZ6K2ce_X3z6-12&quot; edge=&quot;1&quot; parent=&quot;1&quot; source=&quot;pMmGdDlfeZ6K2ce_X3z6-9&quot; style=&quot;endArrow=classic;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;&quot; target=&quot;pMmGdDlfeZ6K2ce_X3z6-11&quot; value=&quot;&quot;&gt;&#10;          &lt;mxGeometry height=&quot;50&quot; relative=&quot;1&quot; width=&quot;50&quot; as=&quot;geometry&quot;&gt;&#10;            &lt;mxPoint x=&quot;560&quot; y=&quot;410&quot; as=&quot;sourcePoint&quot; /&gt;&#10;            &lt;mxPoint x=&quot;610&quot; y=&quot;360&quot; as=&quot;targetPoint&quot; /&gt;&#10;          &lt;/mxGeometry&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;pMmGdDlfeZ6K2ce_X3z6-13&quot; parent=&quot;1&quot; style=&quot;text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;&quot; value=&quot;SMTP&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;30&quot; width=&quot;60&quot; x=&quot;790&quot; y=&quot;560&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;pMmGdDlfeZ6K2ce_X3z6-14&quot; parent=&quot;1&quot; style=&quot;text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;&quot; value=&quot;HTTP&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;30&quot; width=&quot;60&quot; x=&quot;670&quot; y=&quot;480&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;      &lt;/root&gt;&#10;    &lt;/mxGraphModel&gt;&#10;  &lt;/diagram&gt;&#10;&lt;/mxfile&gt;&#10;"><defs/><g><g data-cell-id="0"><g data-cell-id="1"><g data-cell-id="pMmGdDlfeZ6K2ce_X3z6-1"><g transform="translate(0.5,0.5)"><rect x="110" y="0" width="190" height="100" fill="#ffffff" stroke="#000000" pointer-events="all" style="fill: light-dark(#ffffff, var(--ge-dark-color, #121212)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 188px; height: 1px; padding-top: 50px; margin-left: 111px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "> 

## Running Locally

### Prerequisites
- Node.js >= 18
- Docker & Docker Compose

### Start all services
Clone Both email-service and user_auth repository and ensure repository as follows.

## Docker Compose (Overview)
The project is containerized using Docker Compose. The file is located in the parent directory.
```yaml
version: "3.9"

services:
  user-auth-backend:
    build: ./user_auth
    container_name: user-auth-backend
    ports:
      - "${PORT}:3000"             
    env_file:
      - .env                        
    depends_on:
      - user-auth-db
    volumes:
      - ./user_auth:/usr/src/app             
    command: npm run dev             

  user-auth-db:
    image: postgres:15
    container_name: user-auth-db
    ports:
      - "{DB_PORT}:5432"
    environment:
      POSTGRES_USER: ${DB_USER}     # pick from .env
      POSTGRES_PASSWORD: ${DB_PASSWORD}
      POSTGRES_DB: user_auth
    volumes:
      - user-auth-data:/var/lib/postgresql/data

  email-service:
    build: ./email_service
    container_name: email-service
    ports:
      - "{EMAIL_PORT}:3000"
    env_file:
      - .env
    volumes:
      - ./email_service:/usr/src/app
    command: npm run dev

volumes:
  user-auth-data:
```



## File Structure
```
├── user_auth
├── email_service
├── docker-compose.yml
└── .env
```

```bash
docker-compose up
```

## API Endpoints (user-auth)

| Method | Endpoint        | Description              |
|------|-----------------|--------------------------|
| POST | /auth/login       | User login               |
| POST | /auth/signup      | User sign up             |
| POST | /auth/refresh     | Refresh access token     |
| POST | /auth/logout      | Revoke refresh token     |
| Get  | /auth/verify-email| Verify user's email      |


